[{"id":"7cc5b034.d9ba78","type":"ibmiot in","z":"deb0d57.1c46528","authentication":"apiKey","apiKey":"a426bcdc.886758","inputType":"evt","deviceId":"kinectDeviceXXXXXXXX","applicationId":"","deviceType":"kinectDeviceType","eventType":"kinectEvent","commandType":"","format":"json","name":"IBM IoT Input","service":"registered","allDevices":"","allApplications":"","allDeviceTypes":false,"allEvents":false,"allCommands":"","allFormats":"","qos":0,"x":90,"y":420,"wires":[["588e27f2.ae0688"]]},{"id":"86df0b6c.af90c8","type":"comment","z":"deb0d57.1c46528","name":"Device Simulator","info":"Sends simulated device sensor data to IBM Watson IoT Plaform.\n\nCan be configured to send on click or on an automatic interval.\n\n\n#Prerequisite\nOutput node device type and device ID need to match a device that it registered in a running IBM Watson IoT Platform service.\n\n# Watson IoT Platform docs\n[Connecting devices](https://www.bluemix.net/docs/services/IoT/iotplatform_task.html)","x":100,"y":40,"wires":[]},{"id":"ef0e833f.757b7","type":"comment","z":"deb0d57.1c46528","name":"Context Definition","info":"","x":396,"y":98,"wires":[]},{"id":"430666f2.69ca18","type":"function","z":"deb0d57.1c46528","name":"Global Configure ","func":"\n/**\n * Funci�n que inicializa todas las propiedades de la aplicaci�n\n **/\nfunction InitializeConfigure() {\n    this.context.global.set(\"isDebug\",false);\n    this.context.global.set(\"timeDelay\",1000);\n    this.context.global.set(\"numPackets\",15);\n    this.context.global.set(\"numPacketsDebug\",100);\n    return msg;\n}\n\nInitializeConfigure();","outputs":1,"noerr":0,"x":397.2142333984375,"y":144.35715293884277,"wires":[[]]},{"id":"b64ac10f.a8605","type":"function","z":"deb0d57.1c46528","name":"Deserialize Packet Async","func":"\n/**\n * Funci�n que obtiene el payload del paquete\n **/\n function GetPacket(_msg) {\n     var packetID = _msg.payload.packetID;\n     \n     var isDebug = this.context.global.get(\"isDebug\");\n     if(isDebug)\n        node.warn(\"getPacket \"+packetID);\n        \n     return packetID;\n }\n\n/** \n * Funci�n que devuelve si hay un usuario en linea\n **/\nfunction IsUserOnline(_msg){\n    var user = _msg.payload.user;\n    \n     var isDebug = this.context.global.get(\"isDebug\");\n     if(isDebug)\n        node.warn(\"user \"+user);\n        \n    return (user != null || user != undefined || user != \"\");\n}\n\nfunction CreatePropertyPayload(value){\n    var obj = { payload : value };\n    \n    var isDebug = this.context.global.get(\"isDebug\");\n     if(isDebug)\n        node.warn(\"obj: \"+obj.payload);\n     \n     return obj;\n}\n\n/**\n * Funci�n Template Pattern - DSL syntax\n * {} => Es la creaci�n de un objecto vacio\n **/\nfunction DeserializePacket_Main() {\n    return node.send(\n        CreatePropertyPayload(\n            GetPacket(msg)\n        )\n    );\n     \n}\n \nreturn DeserializePacket_Main();","outputs":"1","noerr":0,"x":524,"y":536,"wires":[["8612ef11.ceee08"]]},{"id":"9e316999.81d5b","type":"debug","z":"deb0d57.1c46528","name":"Message Error","active":true,"console":"false","complete":"true","x":981,"y":526,"wires":[]},{"id":"588e27f2.ae0688","type":"switch","z":"deb0d57.1c46528","name":"Validate Packet","property":"payload","propertyType":"msg","rules":[{"t":"null"},{"t":"nnull"}],"checkall":"true","outputs":2,"x":284,"y":421,"wires":[["4d63de21.720938"],["9d3ec2e0.c231"]]},{"id":"9d3ec2e0.c231","type":"function","z":"deb0d57.1c46528","name":"Throttling Async","func":"/**\n * Funci�n que devuelve el Packet ID del cliente Kinect\n **/\nfunction GetPatcketID(){\n    return msg.payload.packetID;\n}\n\n/**\n * Funci�n que muestra por pantalla el env�o del m�dulo X de los paquetes totales hasta el momento\n **/ \nfunction NumPacketsDebug(packetID,_node) {\n    var numPacketsDebug = this.context.global.get(\"numPacketsDebug\");\n    \n    if(packetID % numPacketsDebug == 0) \n     _node.warn(\"Total Packet Id : \"+packetID);\n}\n\n/**\n * Funci�n que salvaguarda el env�o de paquetes del cliente a la aplicaci�n Node-RED\n * Filtra los paquetes enviados \n **/\nfunction ThrottlingAsync(packetID,_node) {\n    var numPackets = this.context.global.get(\"numPackets\");\n    var isDebug = this.context.global.get(\"isDebug\");\n    \n    if(packetID % numPackets == 0){\n        if(isDebug)\n            _node.warn(\"Throttling Async Packet ID\"+packetID);\n            \n        return _node.send(msg);\n    }\n}\n\n/**\n * Funci�n Template Pattern\n **/\nfunction Throttling_Main() {\n    var packetId = GetPatcketID();\n    NumPacketsDebug(packetId, node);\n    ThrottlingAsync(packetId, node);\n}\n\n\nreturn Throttling_Main();","outputs":1,"noerr":0,"x":297,"y":536,"wires":[["b64ac10f.a8605"]]},{"id":"4d63de21.720938","type":"debug","z":"deb0d57.1c46528","name":"Message Error","active":true,"console":"false","complete":"true","x":530,"y":341,"wires":[]},{"id":"8612ef11.ceee08","type":"switch","z":"deb0d57.1c46528","name":"Validate Packet","property":"payload","propertyType":"msg","rules":[{"t":"null"},{"t":"nnull"}],"checkall":"true","outputs":2,"x":768,"y":536,"wires":[["9e316999.81d5b"],["70d45240.904f9c"]]},{"id":"2b0972c6.91b23e","type":"comment","z":"deb0d57.1c46528","name":"@Autor: Victor Bolinches ","info":"","x":130,"y":627,"wires":[]},{"id":"11b74fca.e2f5e","type":"comment","z":"deb0d57.1c46528","name":"IoT Watshon Hackathon","info":"","x":116,"y":363,"wires":[]},{"id":"70d45240.904f9c","type":"ui_text","z":"deb0d57.1c46528","group":"b2ad1aa1.f28258","order":2,"width":0,"height":0,"name":"","label":"Packet ID","format":"{{msg.payload}}","layout":"row-spread","x":965,"y":578,"wires":[]},{"id":"20f1426c.c1b41e","type":"ui_text","z":"deb0d57.1c46528","group":"8079660f.d45af8","order":0,"width":0,"height":0,"name":"Profile Packet","label":"","format":"","layout":"row-center","x":985,"y":450,"wires":[]},{"id":"a98cd9ed.c8f7b","type":"ui_template","z":"deb0d57.1c46528","group":"b2ad1aa1.f28258","name":"Dynamic LoadScriptAsync","order":8,"width":0,"height":0,"format":"<script>\n(function(scope) {\n \n     function loadScript(url, callback) {\n    \n        var script = document.createElement(\"script\")\n        script.type = \"text/javascript\";\n    \n        if (script.readyState) {     \n            script.onreadystatechange = function () {\n                if (script.readyState == \"loaded\" || script.readyState == \"complete\") {\n                    script.onreadystatechange = null;\n                    callback();\n                }\n            };\n        } \n        else { \n            script.onload = function () {\n                 var timer = setInterval(function() {\n                 clearInterval(timer);\n                 callback();\n                 },100);\n            };\n        }\n\n        script.src = url;\n        document.getElementsByTagName(\"head\")[0].appendChild(script);\n    }\n\n     loadScript(\"https://tonejs.github.io/build/Tone.js\", function () {\n        \n        var loaded = 'Tone loaded';\n        console.log(loaded);\n     \n        window.tone = new Tone.Synth().toMaster();\n        tone.triggerAttackRelease(\"C4\", \"8n\");\n     \n     \n     \t\twindow.tone = new Tone.Oscillator({\n     \t\t\t\"frequency\" : 440,\n     \t\t\t\"volume\" : -10\n     \t\t}).toMaster();\n     \t\t\n     \t//\tconsole.log(window.tone);\n     \t\t\n     \t\twindow.toneMaster = Tone.Master;\n     \t\t\n     //\t\tconsole.log(window.toneMaster);\n     });\n \n})(scope);\n</script>\n","storeOutMessages":true,"fwdInMessages":true,"templateScope":"local","x":416.142822265625,"y":190.71429443359375,"wires":[[]]},{"id":"8a0bfa87.63c85","type":"ibmiot in","z":"deb0d57.1c46528","authentication":"boundService","apiKey":"","inputType":"appsts","deviceId":"","applicationId":"","deviceType":"+","eventType":"+","commandType":"","format":"json","name":"IBM IoT App Initialize Context","service":"registered","allDevices":false,"allApplications":false,"allDeviceTypes":true,"allEvents":true,"allCommands":false,"allFormats":false,"qos":"0","x":153,"y":144,"wires":[["430666f2.69ca18"]]},{"id":"a426bcdc.886758","type":"ibmiot","z":"","name":"iot key Hackathon","keepalive":"60","serverName":"","cleansession":true,"appId":"","shared":false}]